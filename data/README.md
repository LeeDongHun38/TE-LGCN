# Data Directory

This directory contains all data files for the TE-LGCN project.

## Directory Structure

```
data/
├── raw/                    # Original unprocessed data
├── processed/              # Filtered and split data
├── embeddings/             # Doc2Vec and other embeddings
└── README.md              # This file
```

---

## Raw Data

**Location**: `data/raw/`

### MovieLens Dataset

This project uses the MovieLens dataset with additional movie plot summaries.

**Required files**:
- `ratings.csv` - User ratings (userId, movieId, rating, timestamp)
- `movies.csv` - Movie metadata (movieId, title, genres)
- `movie_data_final_clean.csv` - Movie plot summaries and metadata

**Download**:
- MovieLens: https://grouplens.org/datasets/movielens/
- Plot summaries were crawled from IMDb

**Not included in repository** (`.gitignore`):
- Large CSV files are excluded from version control
- Download and place in `data/raw/` before running notebooks

---

## Processed Data

**Location**: `data/processed/`

Generated by [notebooks/preprocessing/data_preparation.ipynb](../notebooks/preprocessing/data_preparation.ipynb)

### K-core Filtered Data

**Directories**:
- `k5_filtered/` - Users and items with ≥5 interactions
- `k10_filtered/` - Users and items with ≥10 interactions (more sparse)

**Files** (in each directory):
- `train.csv` - Training interactions
- `val.csv` - Validation interactions (leave-one-out)
- `test.csv` - Test interactions (leave-one-out)
- `user2idx.pkl` - User ID to index mapping
- `item2idx.pkl` - Item ID to index mapping

### Topic Data

Generated by [notebooks/feature_extraction/lda_topics.ipynb](../notebooks/feature_extraction/lda_topics.ipynb)

**Files**:
- `topic_vectors_7.csv` - Item-topic associations (7 topics)
- `topic_vectors_10.csv` - Item-topic associations (10 topics)
- `topic_vectors_15.csv` - Item-topic associations (15 topics)
- `topic_vectors_20.csv` - Item-topic associations (20 topics)

**Format**: `movie_id, topic_id, probability`

---

## Embeddings

**Location**: `data/embeddings/`

Generated by [notebooks/feature_extraction/doc2vec_embeddings.ipynb](../notebooks/feature_extraction/doc2vec_embeddings.ipynb)

**Files**:
- `doc2vec_embeddings_64d.pkl` - Doc2Vec embeddings for all items

**Format** (pickle dictionary):
```python
{
    'embeddings': np.array (n_items, 64),
    'item2idx': dict,
    'n_items': int,
    'vector_size': 64,
    'created_at': str
}
```

---

## Data Statistics

### K=5 Filtered (Recommended)
- Users: 671
- Items: 3,485
- Interactions: 89,927
- Sparsity: 96.15%
- Density: 3.85%

### K=10 Filtered
- Users: 670
- Items: 2,241
- Interactions: 81,800
- Sparsity: 94.55%
- Density: 5.45%

---

## Usage

### Loading Processed Data

```python
import pandas as pd
import pickle

# Load train/val/test splits
train_df = pd.read_csv('data/processed/k5_filtered/train.csv')
val_df = pd.read_csv('data/processed/k5_filtered/val.csv')
test_df = pd.read_csv('data/processed/k5_filtered/test.csv')

# Load ID mappings
with open('data/processed/k5_filtered/user2idx.pkl', 'rb') as f:
    user2idx = pickle.load(f)

with open('data/processed/k5_filtered/item2idx.pkl', 'rb') as f:
    item2idx = pickle.load(f)
```

### Loading Doc2Vec Embeddings

```python
import pickle
import torch

with open('data/embeddings/doc2vec_embeddings_64d.pkl', 'rb') as f:
    doc2vec_data = pickle.load(f)

embeddings = torch.FloatTensor(doc2vec_data['embeddings'])
```

### Loading Topic Data

```python
import pandas as pd

topic_df = pd.read_csv('data/processed/topic_vectors_10.csv')
# Columns: movie_id, topic_id, probability
```

---

## Notes

- All data files are excluded from git (see `.gitignore`)
- Processed data depends on raw data - run preprocessing notebook first
- Doc2Vec embeddings must match the data split (same `item2idx`)
- Topic vectors need to be remapped to LightGCN item indices

---

## Sample Data

For quick testing without downloading the full dataset, a small sample can be added to `data/sample/` (not implemented yet).
